using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace AdventOfCode2023;
internal class DayEleven {
	const string _testSet = "...#......\r\n.......#..\r\n#.........\r\n..........\r\n......#...\r\n.#........\r\n.........#\r\n..........\r\n.......#..\r\n#...#.....";
	const string _dataSet = ".......................................#..........................................................#......................................#..\r\n.....................#................................#.....................................................................................\r\n....#.....#...................#...............#....................#.....................#.....................#....................#.......\r\n............................................................................................................................................\r\n.................#......................................................#......#..............#....................#........................\r\n......................................#.....................................................................................................\r\n.......................................................#...................................................#..............#.................\r\n.............................................................#..........................#...................................................\r\n............#..............................#.................................#.................................................#............\r\n#.................................#.............#................#....................................................................#.....\r\n....................................................................................#................#......................................\r\n....#..........#............#...........................................#..................#..................#...................#.........\r\n......................................#...................#.................................................................#.............#.\r\n........#....................................#.......#......................................................................................\r\n........................................................................................#..........#........................................\r\n..#................................................................#........................................................................\r\n..............................#...............................................#.....................................#............#..........\r\n...................#........................................................................................................................\r\n...........#......................#........#................................................................................................\r\n...............................................................#.................#.........................#................................\r\n......................................................#.....................................#...............................................\r\n........#............................................................................#................................#.........#...........\r\n................#...........#...............................................................................................................\r\n.....................#........................#........................#.....................................#............................#.\r\n....#........................................................#................#.............................................#...............\r\n............................................................................................................................................\r\n.....................................................................................................#.............#...................#....\r\n..........................#...........#.........................................................................................#...........\r\n#......................................................#.........................................#............#........#....................\r\n.........#.....................................#....................................#.......................................................\r\n.................................#..................................#......................................................#........#.......\r\n.........................................................................................................#..................................\r\n......#.............#....................................................#..................................................................\r\n..........................#........................................................................................#........................\r\n.#.......................................#...................#...............#........................#..................#..................\r\n..................................#..............#...........................................................#.................#............\r\n.........#.........................................................#........................#...............................................\r\n....................................................................................#.......................................................\r\n.....#........#............................#...............................#.........................................#......................\r\n......................................................................#..................................#..................................\r\n............................#..................#........#..............................................................................#....\r\n.......................#.............#......................................................................................................\r\n#..........#...................................................#.......................#........................#......#....................\r\n....................................................#.............................................#.........................................\r\n.................................................................................................................................#..........\r\n..................................#....................................................................#....................................\r\n........#.......................................#............#.....#........#...............................................................\r\n............................................................................................................................................\r\n............................................................................................................................................\r\n..........................#.............................................................#.........................#.........................\r\n..#............................#..........#..................................................................................#..............\r\n..................#...................................................#.............#.......................#.............................#.\r\n............#.................................#........#.....#..............................................................................\r\n............................................................................................................................................\r\n.......................................................................................#..............#.................#...........#.......\r\n....................#.....#....................................................#............#.................#.............................\r\n....#............................................................................................#..............................#..........#\r\n............................................................................................................................................\r\n...............................#......................#...............................................................#.....................\r\n.................................................#...............#..................#.........#.............................#...............\r\n........#......#.....................#................................................................................................#.....\r\n.............................................#.................................#............................................................\r\n.#......................#..............................................................#................#...................................\r\n............#.....#.....................................................................................................#...................\r\n..................................#.....................................................................................................#...\r\n............................................................................................................................................\r\n......#...............................................................#........................#..............................#.............\r\n.....................#...........................#....................................#..............................#......................\r\n............................................................................#...............................................................\r\n............#................#........#.......................#.....................................#.......................................\r\n............................................................................................#.................#...........#.................\r\n...................#................................................................................................................#.......\r\n...................................#...................#..........#............#............................................................\r\n#.........................................#.....#..................................................................#........................\r\n............................................................................................................#....................#..........\r\n..........#..........................................................#.................................#...................................#\r\n............................................................................................................................................\r\n......#.................#.......................................................#...............#.........................#.................\r\n.............................#................#...................#.............................................#...........................\r\n.............#.......................................#......................#.......#................................#......................\r\n........................................#................................................#...........................................#......\r\n...................................#........................................................................................................\r\n.................#...........................................#..............................................................#...............\r\n.........#................#.......................................................................................#.........................\r\n.....................#......................................................................................................................\r\n.#..............................................................#............#..........#.....#.........#...................................\r\n......#.................................#.............................#.....................................................................\r\n................................................................................................................................#...........\r\n......................................................#............................................#....................#..............#....\r\n.........................#...................#..............................................................................................\r\n...............................................................#............#..........#.................#..................................\r\n..................................#.........................................................................................................\r\n...............#..........................................................................................................#......#..........\r\n............................................................................................................................................\r\n......#........................................#..................................#................#..................................#.....\r\n.#..........................#.........#.............................................................................#.......................\r\n.......................................................#......................#.......#.....................................................\r\n.............................................................#.................................................................#............\r\n...............#......................................................................................#.......#...........................#.\r\n.....#....................................................................#...................#.............................................\r\n..........................#................#.....#................#.........................................................................\r\n..................................................................................#.................................#......#...........#....\r\n.................#..........................................................................................................................\r\n..................................#.........................................................................................................\r\n...........#.........................................#.................#...............#....................................................\r\n................................................................#..............................#..........#....................#............\r\n...............#.............#............................#..................#..............................................................\r\n..#............................................#...........................................................................#................\r\n......................#.....................................................................................................................\r\n.......................................#.................................#..........................................................#.......\r\n...................................................................#........................................................................\r\n....#.............#................................................................#..................................#......#..............\r\n.............................................................#..............................................................................\r\n.........#................#.....................#.....................#.....#.....................#.......#.................................\r\n...................................................................................................................................#........\r\n...........................................#...............................................#................................................\r\n.....................................................#..........#....................#...........................#............#.........#...\r\n.#.............#......#.....................................................................................................................\r\n.............................#............................................#..............................#..................................\r\n.......................................#............................................................................#.......................\r\n..................#......................................#............#.............................#.......................................\r\n.........#................#.....................................................#..............#.............#....................#.......#.\r\n..#..............................................................#.........................................................#................\r\n...................................#..........#.............................#.........................................................#.....\r\n......#..............................................................................................................#......................\r\n..............#.............................................................................................................................\r\n......................................................#........#.................#.......................................#..................\r\n......................#.......#.................#......................................#.......#...............#............................\r\n..#..............#.......................#..................................................................................................\r\n.......................................................................#...................#.............#..................................\r\n.........#..........................................................................#.................................#.....................\r\n......................................#..................#.......................................#....................................#.....\r\n.........................#............................................................................#.......#.............#...............\r\n....................#.........................................#.............................................................................\r\n...............#............................................................................................................................\r\n......................................................................#...........#........#...................................#............\r\n.................................#..........#...............................................................................................\r\n......#..........................................#............................#....................................#........................\r\n...............................................................#...........................................#.............................#..\r\n..#.........#..........#.................#..........................................................#.......................................";

	public DayEleven() {
		Console.WriteLine("\n*** Day Eleven ***\n");
		Console.WriteLine("Sum of shortest path between each galaxies after expension: " + PartOne(_dataSet));
		Console.WriteLine("Sum of shortest path between each galaxies after expension with 1 million scaling: " + PartTwo(_dataSet));
	}

	private static long PartOne(string data) {
		// Can be updated with solution for part two which is better
		return CoordinatesToDistances(GalaxiesToCoordinates(ExpandUniverse(data.Split("\r\n")))).Sum();
	}

	private static List<string> ExpandUniverse(string[] data) {
		List<string> res = [];

		// Expanding rows
		for(int i = 0; i < data.Length; i++) {
			res.Add(data[i]);

			if(!data[i].Contains('#')) {
				res.Add(data[i]);
			}
		}

		// Expanding columns
		for(int i = 0; i < res[0].Length; i++) {
			if(ColumnContainsNoGalaxy(res, i)) {
				for(int y = 0; y < res.Count; y++) {
					res[y] = res[y].Insert(i, ".");
				}
				i++;
			}
		}

		return res;
	}

	private static bool ColumnContainsNoGalaxy(List<string> data, int idx) {
		foreach(string line in data) {
			if(line[idx] == '#') {
				return false;
			}
		}

		return true;
	}

	private static List<(long, long)> GalaxiesToCoordinates(List<string> universe) {
		List<(long, long)> res = [];

		for(int i = 0; i < universe.Count; i++) {
			for(int y = 0; y < universe[i].Length; y++) {
				if(universe[i][y] == '#') {
					res.Add((y, i));
				}
			}
		}

		return res;
	}

	private static List<long> CoordinatesToDistances(List<(long, long)> coordinates) {
		List<long> res = [];

		for(int i = 0; i < coordinates.Count - 1; i++) {
			for(int j = i + 1; j < coordinates.Count; j++) {
				res.Add(TaxicabDistance(coordinates[i], coordinates[j]));
			}
		}

		return res;
	}

	private static long TaxicabDistance((long x, long y) a, (long x, long y) b) {
		return Math.Abs(a.x - b.x) + Math.Abs(a.y - b.y);
	}

	private static long PartTwo(string data) {
		List<string> universe = [.. data.Split("\r\n")];

		return CoordinatesToDistances(ApplyScaling(GalaxiesToCoordinates(universe), UniverseScaling(universe), 1000000)).Sum();
	}

	private static List<List<long>> UniverseScaling(List<string> data) {
		List<long> emptyRows = [];
		List<long> emptyColumns = [];

		for(int i = 0; i < data.Count; i++) {
			if(!data[i].Contains('#')) {
				emptyRows.Add(i);
			}
		}

		for(int i = 0; i < data[0].Length; i++) {
			if(ColumnContainsNoGalaxy([..data], i)) {
				emptyColumns.Add(i);
			}
		}

		return [emptyColumns, emptyRows];
	}

	private static List<(long, long)> ApplyScaling(List<(long x, long y)> coordinates, List<List<long>> scaling, long expensionSize = 2) {
		List<(long, long)> res = [];

		for(int i = 0; i < coordinates.Count; i++) {
			int xScale = scaling[0].Where(x => x < coordinates[i].x).Count();
			int yScale = scaling[1].Where(y => y < coordinates[i].y).Count();

			res.Add((coordinates[i].x + xScale * (expensionSize - 1), coordinates[i].y + yScale * (expensionSize - 1)));
		}

		return res;
	}
}

